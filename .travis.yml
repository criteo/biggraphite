language: python
python:
  - 2.7
jdk:
  - oraclejdk8

install:
  ### Java: We download now some dependencies to limit the number of messages later
  - if $JAVA; then mvn dependency:resolve-plugins dependency:resolve -B -V ; fi
  ### Python build dependencies
  - pip install tox coveralls
script:
  ### Java
  - if $JAVA; then mvn verify -B -V ; fi
  ### Python
  - tox
after_success:
  ### Python
  - coveralls

### sudo is required by pip
sudo: required

### As of 2016-11, when Sudo is required, java8 is removed (WHY?)
dist: trusty
addons:
  apt:
    packages:
      - oracle-java8-installer

env:
  matrix:
    - JAVA=true  TOXENV=pylama # We build Java once only
    - JAVA=false TOXENV=pypy-coverage
    - JAVA=false TOXENV=py27-coverage
  global:
    ### As of 2016-04 Travis provides Cassandra 2.1 by default so we bundle our own
    - CASSANDRA_VERSION=3.9
    - CASSANDRA_HOME="${TRAVIS_BUILD_DIR}/apache-cassandra-${CASSANDRA_VERSION}/"

### As of 2016-04 Travis provides Cassandra 2.1 by default so we bundle our own
before_install:
   - wget "http://www.us.apache.org/dist/cassandra/${CASSANDRA_VERSION}/apache-cassandra-${CASSANDRA_VERSION}-bin.tar.gz"
   - tar -xzf "apache-cassandra-${CASSANDRA_VERSION}-bin.tar.gz"
